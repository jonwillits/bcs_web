{% extends "base.html" %}

{% block content %}

    <div class="wrapper">

        <!-- Sidebar Holder -->
        <nav id="sidebar">
            <div class="sidebar-header">
                {% for node in nodes %}
                    {{ loop.index0 * 4 * '&nbsp;' | safe}}
                    {%  if loop.index == loop.length %}
                        <a href={{ url_for('module', branch='/'.join(nodes), leaf='home') }}>
                            &rArr; {{ node.replace('_', ' ') }}
                        </a>
                    {%  else %}
                        &rArr; {{ node.replace('_', ' ') }}
                    {%  endif %}
                    <hr>
                {% endfor %}
            </div>

            <ul class="list-unstyled components">
                {%  if submodules %}
                    {{ submodules | safe }}
                {%  endif %}
            </ul>

        </nav>

        <!-- Page Content Holder -->
        <div id="content-module">

            <div class="panel panel-default">

                <div class="container-fluid">
                    <div class="navbar-header">
                        <button type="button" id="sidebarCollapse" class="btn btn-info navbar-btn">
                            <i class="glyphicon glyphicon-align-left"></i>
                            <span>Toggle Sidebar</span>
                        </button>
                    </div>
                </div>

                <div class="panel-body">
                    {{ content | safe }}
                </div>

                <div class="panel-pagination">
                    <nav aria-label="Page navigation">
                        <ul class="pagination">
                            <li class="page-item"><a class="page-link" href="#">Previous</a></li>
                            <li class="page-item"><a class="page-link" href="#">Top</a></li>
                            <li class="page-item"><a class="page-link" href="#">Next</a></li>
                        </ul>
                    </nav>
                </div>

            </div>

        </div>
    </div>


    <script>

        /* persist state of side menu across page loads by showing any dropdown list when the section number of the section requested starts with the section number that is contained in the text of the dropdown */

        const dropdown = document.getElementsByClassName("dropdown-jw");
        const sectionNum = window.location.href.split('m').pop().replace(/_/g, '.').replace(/^0+/, '');
        for (let i = 0; i < dropdown.length; i++) {
            const dropdownSectionNum = dropdown[i].textContent.split(' ')[0];
            console.log(dropdownSectionNum, sectionNum);
            if (sectionNum.startsWith(dropdownSectionNum)) {
                dropdown[i].classList.add('active');
                const dropdownContent = dropdown[i].nextElementSibling;
                if (dropdownContent) {
                    console.log(dropdownContent);
                    if (dropdownContent.style.display === "block") {
                        dropdownContent.style.display = "none";
                    } else {
                        dropdownContent.style.display = "block";
                    }
                } else {
                    console.log('dropdownContent is null')
                }
            }

        }

        /* module side menu script */
        /* Loop through all dropdown buttons to toggle between hiding and showing its dropdown content - This allows the user to have multiple dropdowns without any conflict */
        for (let i = 0; i < dropdown.length; i++) {
            dropdown[i].addEventListener("click", function() {
                this.classList.toggle("active");
                const dropdownContent = this.nextElementSibling;
                if (dropdownContent.style.display === "block") {
                    dropdownContent.style.display = "none";
                } else {
                    dropdownContent.style.display = "block";
                }
            });
        }
    </script>


    <!-- jQuery CDN required for Toggle Sidebar button-->
    <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            $('#sidebarCollapse').on('click', function () {
                $('#sidebar').toggleClass('active');
            });
        });
    </script>


{% endblock %}



