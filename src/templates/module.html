{% extends "base.html" %}

{% block content %}

    <div class="wrapper">

        <!-- Sidebar Holder -->
        <nav id="sidebar">
            <div class="sidebar-header">
                {% for node in nodes %}
                    {{ loop.index0 * 4 * '&nbsp;' | safe}}
                    {%  if loop.index == loop.length %}
                        <a href={{ url_for('module', branch='/'.join(nodes), leaf=default_leaf) }}>
                            &rArr; {{ node.replace('_', ' ') }}
                        </a>
                    {%  else %}
                        &rArr; {{ node.replace('_', ' ') }}
                    {%  endif %}
                    <hr>
                {% endfor %}
            </div>

            <ul class="list-unstyled components">
                {%  if side_content %}
                    {{ side_content | safe }}
                {%  endif %}
            </ul>

        </nav>

        <!-- Page Content Holder -->
        <div id="content-module">

            <div class="panel panel-default">

                <div class="container-fluid">
                    <div class="navbar-header">
                        <button type="button" id="sidebarCollapse" class="btn btn-info navbar-btn">
                            <i class="glyphicon glyphicon-align-left"></i>
                            <span>Toggle Sidebar</span>
                        </button>
                    </div>
                </div>

                <div class="panel-body">
                    {{ main_content | safe }}
                </div>

                <div class="panel-pagination">
                    <nav aria-label="Page navigation">
                        <ul class="pager">
                            {%  if previous_leaf %}
                                <li class="previous">
                                    <a href={{ url_for('module', branch='/'.join(nodes), leaf=previous_leaf) }}>
                                        <span aria-hidden="true">&larr;</span>Prev
                                    </a>
                                </li>
                            {% endif %}
                            {%  if next_leaf %}
                                <li class="next">
                                    <a href={{ url_for('module', branch='/'.join(nodes), leaf=next_leaf) }}>
                                        Next<span aria-hidden="true">&rarr;</span>
                                    </a>
                                </li>
                            {% endif %}
                        </ul>
                    </nav>
                </div>

            </div>
        </div>
    </div>


    <script>

        const sectionNum = window.location.href.split('m').pop().replace(/_/g, '.').replace(/^0+/, '');
        const links = document.getElementsByClassName("dropdown-no");
        const dropdowns = document.getElementsByClassName("dropdown-yes");

        /* persist state of side menu across page loads by showing any dropdown list when the section number of the section requested starts with the section number that is contained in the text of the dropdowns */
        for (let i = 0; i < dropdowns.length; i++) {
            const dropdownSectionNum = dropdowns[i].textContent.split(' ')[0];
            console.log(dropdownSectionNum, sectionNum);
            if (sectionNum.startsWith(dropdownSectionNum)) {
                dropdowns[i].classList.add('active');
                const dropdownContent = dropdowns[i].nextElementSibling;
                if (dropdownContent) {
                    console.log(dropdownContent);
                    if (dropdownContent.style.display === "block") {
                        dropdownContent.style.display = "none";
                    } else {
                        dropdownContent.style.display = "block";
                    }
                } else {
                    console.log('dropdownContent is null')
                }
            }
        }

        /* change background of link which user clicked to load this page */
        for (let i = 0; i < links.length; i++) {
            const containerSectionNum = links[i].textContent.split(' ')[0];
            console.log(containerSectionNum, sectionNum);
            if (containerSectionNum.startsWith(sectionNum)) {
                links[i].classList.add('reading');
                console.log('adding tag to class list')
            }

        }

        /* module side menu script */
        /* Loop through all dropdowns buttons to toggle between hiding and showing its dropdowns content - This allows the user to have multiple dropdowns without any conflict */
        for (let i = 0; i < dropdowns.length; i++) {
            dropdowns[i].addEventListener("click", function() {
                this.classList.toggle("active");
                const dropdownContent = this.nextElementSibling;
                if (dropdownContent.style.display === "block") {
                    dropdownContent.style.display = "none";
                } else {
                    dropdownContent.style.display = "block";
                }
            });
        }
    </script>


    <!-- jQuery CDN required for Toggle Sidebar button-->
    <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            $('#sidebarCollapse').on('click', function () {
                $('#sidebar').toggleClass('active');
            });
        });
    </script>


{% endblock %}



